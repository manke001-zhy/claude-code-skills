# 广播剧制作快速参考

## 一键制作命令

```bash
# 完整流程（简单格式）
python make_drama.py 脚本.md -o 对话.txt && python drama_to_audio.py 对话.txt 广播剧.mp3

# 完整流程（复杂格式，带角色列表）
python extract_dialogues_v2.py 脚本.md -o 对话.txt && python drama_to_audio.py 对话.txt 广播剧.mp3
```

## 脚本格式识别

### 格式1：简单对话（推荐）
```
【角色名】对话内容
```
无角色列表，直接开始对话。使用 `make_drama.py`

### 格式2：复杂格式（带角色列表）
```markdown
### **角色列表**

【旁白】全知视角，负责交代背景。

【主角】主角，二十岁，性格开朗。

【旁白】魔王城矗立在荒凉的平原之上，阴森的云层压得很低。

【主角】唉，人生剧本是不是拿错了。
```
有角色列表部分。使用 `extract_dialogues_v2.py`

⚠️ **注意**：开篇旁白（>80字）必须保留！

## 关键优化

| 优化项 | 操作 | 原因 |
|--------|------|------|
| 去除动作 | 删除 `\[...\]` | TTS不朗读动作 |
| 冒号→逗号 | `：` → `，` | 避免停顿 |
| 去除空行 | 删除空行 | 提高效率 |

## 声音配置速查

```python
VOICE_MAP = {
    '旁白': 'zh-CN-YunjianNeural',    # 成熟男声
    '少年男主': 'zh-CN-YunxiNeural',   # 年轻男声
    '成年男主': 'zh-CN-YunzeNeural',   # 成熟男声
    '少女AI': 'zh-CN-XiaoxiaoNeural',  # 温柔女声
    '成熟女性': 'zh-CN-XiaoyiNeural',  # 成熟女声
    '活泼少女': 'zh-CN-XiaomengNeural',# 活泼女声
}
```

## 常见问题

**Q: 对话被截断？**
A: 检查脚本是否正确处理冒号

**Q: 朗读不流畅？**
A: 确保冒号已替换为逗号

**Q: 声音不明显？**
A: 使用明显不同的声音类型

## 质量检查清单

- [ ] 对话数量正确
- [ ] 内容完整无截断
- [ ] 冒号已替换为逗号
- [ ] 角色声音区分明显
- [ ] 音频大小合理（~3MB/1000字）

## 文件示例

**输入** (`脚本.md`):
```markdown
**\[旁白\]**：
新东京历，3024年。

**\[艾米\]**：
\[机械式\] 喂，起床了。
```

**输出** (`对话.txt`):
```
【旁白】新东京历，3024年。
【艾米】喂，起床了。
```

**音频** (`广播剧.mp3`):
```
[OK] 音频已生成: 广播剧.mp3
[INFO] 文件大小: 2.9 MB
```

## 更多信息

- 完整教程：查看 SKILL.md
- 脚本说明：查看 scripts/README.md
- 经验总结：查看 广播剧制作经验总结.md
- Bug修复：查看 Bug修复_开篇旁白丢失.md

## 快速修复指南

### 问题：开篇旁白丢失

**症状**：第一段对话不是旁白，而是主角台词

**原因**：脚本包含角色列表部分，被误删

**快速修复**：
```bash
# 使用改进的提取工具（自动跳过角色列表）
python extract_dialogues_v2.py 脚本.md -o 对话_修复.txt

# 重新生成音频
python drama_to_audio.py 对话_修复.txt 广播剧_修复.mp3
```

**验证方法**：
```bash
# 检查第一段是否是旁白
head -1 对话_修复.txt
# 应该看到：【旁白】...背景交代...
```

### 问题：对话内容被截断

**症状**：冒号后面的内容丢失

**原因**：冒号被当作分隔符处理

**快速修复**：
```bash
# 使用不替换冒号的选项
python extract_dialogues_v2.py 脚本.md -o 对话.txt --no-replace-colons
```

### 问题：角色声音不对

**症状**：所有角色听起来像同一个声音

**快速修复**：
1. 编辑 `drama_to_audio.py`
2. 在 `VOICE_MAP` 中添加角色映射：
```python
VOICE_MAP = {
    '你的角色名': 'zh-CN-XiaoxiaoNeural',
}
```
3. 重新生成音频
