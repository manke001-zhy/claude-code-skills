# 广播剧制作经验总结

## 项目列表

### 项目1：《三千年后的我与AI女友还在吵架》
- **日期**：2025-01-26
- **对话数**：65个片段
- **音频大小**：2.9MB
- **格式**：`**\[角色\]**：对话`
- **特点**：科幻题材，AI角色

### 项目2：《转生到异世界当骑士，但公主意外地难搞》
- **日期**：2025-01-26
- **对话数**：50个片段
- **音频大小**：2.2MB
- **格式**：`【角色】对话`（带角色列表）
- **特点**：异世界题材，多角色（5个角色）

---

## 项目2信息

- **项目名称**：《转生到异世界当骑士，但公主意外地难搞》
- **制作日期**：2025-01-26
- **音频时长**：约2.2MB（50个对话片段）
- **使用工具**：edge-tts + Python

## 制作流程

### 1. 原始脚本格式

```markdown
**\[旁白\]**：
\[音色建议：磁性、稳重、全知视角、带有淡淡的叙述感\]

**\[和也\]**：
\[男，20岁。有些颓废、固执，唯一的"肉身保留派"，性格直率，带点吐槽属性\]

**\[艾米\]**：
\[AI管家，外形为女高中生。性格毒舌、活泼，逻辑严密，热衷于调侃和也\]

**\[星空\]**：
\[女，转校生。银发紫瞳，清冷、知性，聪明绝顶却对"原始生活"充满好奇\]

### **第一场景：被闹钟吵醒的第365,000天**

**\[旁白\]**：
新东京历，3024年。这是一个人类早已习惯将意识上传到云端的时代，钢铁与霓虹交织在城市的每个角落。

**\[艾米\]**：
\[机械式的轻快感\] 喂，和也，起床了。根据早间气象和你的睡眠数据分析，今天的幸福指数只有百分之三十二，建议你直接放弃挣扎，继续梦游。
```

### 2. 转换后的对话格式

```
【旁白】新东京历，3024年。这是一个人类早已习惯将意识上传到云端的时代，钢铁与霓虹交织在城市的每个角落。然而，在一间略显破旧的实体公寓里，阳光费力地挤过厚重的窗帘缝隙，照在乱糟糟的床铺上。一个蓝色的全息投影在半空中悠然转圈，打破了清晨的宁静。

【艾米】喂，和也，起床了。根据早间气象和你的睡眠数据分析，今天的幸福指数只有百分之三十二，建议你直接放弃挣扎，继续梦游。

【和也】艾米……我求你了，能不能把闹钟铃声换成正常人类的？刚才那个《命运之轮》的主题曲……实在是太中二了。
```

### 3. 关键优化点

#### 优化1：去除动作描述

**原文**：
```
\[机械式的轻快感\] 喂，和也，起床了。
```

**处理后**：
```
喂，和也，起床了。
```

#### 优化2：替换冒号为逗号 ⭐ 重要

**原文**：
```
好的……根据你的智商和一贯的写作风格，生成结果如下：意识上传就是永生，因为我上去了就没下来。完毕。
```

**问题**：TTS在冒号处有停顿，影响流畅度

**优化后**：
```
好的……根据你的智商和一贯的写作风格，生成结果如下，意识上传就是永生，因为我上去了就没下来。完毕。
```

#### 优化3：保留完整对话

**注意**：确保冒号后的内容不丢失

**原文**：
```
数据统计显示，你写论文的套路永远是：开头抄百度百科，中间讲故事，结尾升华主题……并以失败告终。
```

**正确处理**：
```
数据统计显示，你写论文的套路永远是，开头抄百度百科，中间讲故事，结尾升华主题……并以失败告终。
```

### 4. 角色声音配置

| 角色 | 声音ID | 特点 | 原因 |
|------|--------|------|------|
| 旁白 | zh-CN-YunjianNeural | 成熟男声，磁性 | 符合全知视角的叙述感 |
| 和也 | zh-CN-YunxiNeural | 年轻男声，少年音 | 20岁主角，年轻活力 |
| 艾米 | zh-CN-XiaoxiaoNeural | 温柔女声，AI少女 | AI管家，活泼可爱 |
| 星空 | zh-CN-XiaoyiNeural | 成熟女声，温柔少女 | 转校生，知性冷静 |

## 遇到的问题及解决方案

### 问题1：对话内容被截断

**症状**：
```
原文：生成结果如下：意识上传就是永生
实际：生成结果如下（后面的丢失）
```

**原因**：
- 脚本把对话中的冒号当作分隔符
- 正则表达式匹配逻辑错误

**解决方案**：
- 修改脚本，只在对话开头匹配角色名
- 保留对话内部的所有标点符号
- 先打印预览验证完整性

### 问题2：TTS朗读不流畅

**症状**：
- 冒号处有明显停顿
- 语调不连贯

**解决方案**：
- 统一将对话中的冒号替换为逗号
- 保留角色名后的冒号（不参与TTS）

**代码示例**：
```python
# 只替换对话内容中的冒号
if '】' in line:
    parts = line.split('】', 1)
    role = parts[0] + '】'
    dialogue = parts[1].replace('：', '，').replace(':', '，')
    fixed_lines.append(role + dialogue)
```

### 问题3：角色声音不明显

**症状**：
- 多个角色听起来像同一个声音

**解决方案**：
- 使用明显不同的声音类型
- 旁白用成熟男声（云建）
- 少年用年轻男声（云希）
- 少女用温柔女声（晓晓/晓伊）

### 问题4：开篇旁白丢失 ⚠️ 项目2特有问题

**症状**：
```
原文：【旁白】魔王城矗立在荒凉的平原之上，阴森的紫黑色云层压得很低...
实际：第一段对话从主角开始，缺少背景交代
```

**原因**：
- 脚本包含"角色列表"部分（格式3）
- 简单的关键词匹配误删开篇旁白
- 例如：`if '魔王城' in dialogue: continue`

**解决方案**：
```python
skip_intro = True  # 跳过角色列表

for line in lines:
    match = re.match(r'^【(.+?)】(.+)$', line)
    if match:
        role, dialogue = match.groups()

        # 遇到第一个长对话（>80字），说明角色列表结束
        if skip_intro and len(dialogue) > 80:
            skip_intro = False

        # 跳过角色列表
        if skip_intro:
            continue

        # 处理对话...
```

**关键原则**：
- ✅ **开篇旁白必须保留**，用来交代背景和场景
- ✅ 角色列表的描述很短（<80字）
- ✅ 真正的对话和旁白通常较长（>80字）
- ❌ 不要用内容关键词来判断是否删除

**对比**：
- **修复前**：44个对话，1.8MB
- **修复后**：50个对话，2.2MB
- **差异**：找回了6个被误删的对话

## 最佳实践

### 1. 脚本准备

✅ **推荐格式**：
```markdown
**\[角色名\]**：
\[动作描述\] 对话内容
```

✅ **命名规则**：
- 使用简短易记的名字（2-3个字）
- 避免特殊字符和标点
- 保持全剧一致性

### 2. 文本处理

✅ **必须去除**：
- 动作描述：`\[...\]`
- 情感提示：`\[睡眼惺忪\]`
- 角色介绍：`\[男，20岁...\]`

✅ **必须替换**：
- 冒号 → 逗号（提升流畅度）

✅ **必须保留**：
- 情感标点：`……`
- 强调标点：`！`
- 引号内容：《书名》

### 3. 声音选择

**旁白**：
- 使用成熟、磁性、稳重的声音
- 推荐：云建（zh-CN-YunjianNeural）

**男主**：
- 少年角色：年轻、清爽的声音
- 推荐：云希（zh-CN-YunxiNeural）
- 成年角色：稳重、成熟的声音
- 推荐：云泽（zh-CN-YunzeNeural）

**女主**：
- AI/活泼：温柔、可爱的声音
- 推荐：晓晓（zh-CN-XiaoxiaoNeural）
- 成熟/知性：温柔、成熟的声音
- 推荐：晓伊（zh-CN-XiaoyiNeural）

### 4. 质量控制

**生成前**：
- [ ] 检查脚本格式统一
- [ ] 验证角色名称一致性
- [ ] 确认声音配置正确

**生成后**：
- [ ] 对话数量正确（与脚本一致）
- [ ] 对话内容完整（无截断）
- [ ] 音频文件大小合理（约3MB/1000字）
- [ ] 试听前几条验证质量

## 技术细节

### 文件编码
- 必须使用 UTF-8 编码
- Windows记事本保存时选择"UTF-8"

### 音频参数
- 格式：MP3
- 采样率：默认（24kHz）
- 比特率：默认（约128kbps）
- 文件大小：约2.9MB / 65个对话

### 性能优化
- 使用异步生成（edge-tts默认）
- 批量处理（每次65个片段）
- 自动合并（使用ffmpeg）

## 输出文件

### 对话文件格式
```
【旁白】新东京历，3024年。这是一个人类早已习惯将意识上传到云端的时代。
【艾米】喂，和也，起床了。根据早间气象和你的睡眠数据分析，今天的幸福指数只有百分之三十二，建议你直接放弃挣扎，继续梦游。
【和也】艾米……我求你了，能不能把闹钟铃声换成正常人类的？刚才那个《命运之轮》的主题曲……实在是太中二了。
```

### 音频生成日志
```
[INFO] 读取稿子: 广播剧_最终版.txt
[INFO] 识别到 65 个对话片段

[预览] 前3个片段：
  旁白 (zh-CN-YunjianNeural): 新东京历，3024年...
  艾米 (zh-CN-XiaoxiaoNeural): 喂，和也，起床了...
  和也 (zh-CN-YunxiNeural): 艾米……我求你了...

[INFO] 共 65 个片段
[INFO] 正在合并音频...
[OK] 音频已生成: 广播剧_最终版.mp3
[INFO] 文件大小: 2.9 MB
```

## 总结

### 项目1总结：《三千年后的我与AI女友还在吵架》

本次项目成功制作了包含65个对话片段的广播剧音频，总时长约2.9MB。通过以下关键优化确保了高质量输出：

1. ✅ **去除动作描述**：只保留纯对话内容
2. ✅ **替换冒号为逗号**：提升TTS朗读流畅度
3. ✅ **保留完整对话**：确保内容不丢失
4. ✅ **合理配置声音**：旁白成熟，角色年轻

### 项目2总结：《转生到异世界当骑士，但公主意外地难搞》

本次项目成功制作了包含50个对话片段的异世界广播剧音频，总时长约2.2MB。相比项目1，遇到了新的挑战：

1. ✅ **识别脚本格式**：处理带角色列表的复杂格式
2. ✅ **保留开篇旁白**：修复了误删背景交代的问题
3. ✅ **支持多角色配音**：5个角色使用不同声音
4. ✅ **改进提取工具**：创建通用提取工具extract_dialogues_v2.py

**重要教训**：
- ⭐ 每个广播剧开头的长旁白（>80字）都保留，用来交代背景
- ⭐ 不要用内容关键词来判断是否删除对话
- ⭐ 使用长度和位置来区分角色列表和实际对话

**技术改进**：
- 创建了通用提取工具`extract_dialogues_v2.py`
- 支持3种脚本格式
- 自动识别和跳过角色列表
- 可配置的最小对话长度

### 总体经验

两个项目展示了不同的脚本格式和挑战，共同的经验包括：

1. **脚本处理**：
   - 识别脚本结构（角色列表 vs 实际对话）
   - 保留开篇旁白（背景交代）
   - 去除动作描述和提示

2. **文本优化**：
   - 冒号替换为逗号（提升流畅度）
   - 保留完整对话内容
   - 避免关键词过滤

3. **声音配置**：
   - 旁白用成熟音（云建）
   - 角色用年轻音（云希/晓晓）
   - 提前添加角色映射

4. **质量保证**：
   - 验证开篇旁白
   - 检查对话完整性
   - 试听验证效果

整个流程已经固化到tts-converter技能中，可以通过以下命令快速制作新的广播剧：

```bash
# 提取对话
python make_drama.py 脚本.md -o 对话.txt

# 生成音频
python drama_to_audio.py 对话.txt 广播剧.mp3
```

经验教训和最佳实践已记录在技能文档中，可供后续项目参考。
