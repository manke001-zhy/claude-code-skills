# 集成GPT-SoVITS到现有项目

## 📝 方案1: 最简单方式(推荐)

**不需要修改现有代码！**

只需修改声音映射配置，让小孩/老人角色使用GPT-SoVITS生成的声音。

### 步骤:

1. **用GPT-SoVITS提前生成所有音频**

```bash
# 1. 启动GPT-SoVITS服务
cd GPT-SoVITS
python api.py --port 9882

# 2. 使用新脚本生成小孩/老人声音
python generate_special_voices.py --role child --output voices/child.mp3
python generate_special_voices.py --role elderly --output voices/elderly.mp3

# 3. 手动替换音频文件
# 将生成的音频文件手动合并到广播剧中
```

2. **使用音频编辑软件合并**
- 使用 Audacity (免费)
- 或 Adobe Audition
- 手动将小孩/老人的音频片段替换为GPT-SoVITS生成的

**优点：**
- ✅ 不需要改代码
- ✅ 灵活可控
- ✅ 容易调试

**缺点：**
- ❌ 需要手动操作
- ❌ 无法自动化

---

## 📝 方案2: 使用新的多后端系统(自动化)

我已经创建了 `tts_factory.py`，现在教你如何集成。

### 步骤1: 创建配置文件

创建 `tts_config.json`:

```json
{
  "default_backend": "hybrid",
  "backends": {
    "edge": {
      "enabled": true
    },
    "gptsovits": {
      "enabled": true,
      "api_url": "http://localhost:9882"
    }
  },
  "voice_routing": {
    "child_male": "gptsovits",
    "child_female": "gptsovits",
    "elderly_male": "gptsovits",
    "elderly_female": "gptsovits"
  }
}
```

### 步骤2: 修改voice_matcher.py

在声音库中添加GPT-SoVITS的声音:

```python
# 在VOICE_LIBRARY中添加
'小孩-男(GPT-SoVITS)': {
    'voice': 'child_male',
    'description': '小男孩(GPT-SoVITS)',
    'category': 'child',
    'backend': 'gptsovits'
},
'老人-男(GPT-SoVITS)': {
    'voice': 'elderly_male',
    'description': '老年男性(GPT-SoVITS)',
    'category': 'elderly',
    'backend': 'gptsovits'
},
```

### 步骤3: 修改drama_to_audio_v2.py

在生成音频时使用多后端:

```python
async def generate_audio(self, segments, output_file, voice_assignments=None):
    # 导入TTS工厂
    from tts_factory import TTSFactory, HybridTTSBackend

    # 创建后端
    edge_backend = TTSFactory.create_backend('edge')

    # 如果GPT-SoVITS可用，创建混合后端
    try:
        gptsovits_backend = TTSFactory.create_backend(
            'gptsovits',
            api_url='http://localhost:9882'
        )
        backend = HybridTTSBackend(
            default_backend=edge_backend,
            special_backends={'gptsovits': gptsovits_backend}
        )
    except:
        print("[WARN] GPT-SoVITS不可用，使用Edge TTS")
        backend = edge_backend

    # 使用backend生成音频...
```

---

## 🎯 我的最终建议

### 渐进式集成策略

**阶段1: 今天(5分钟)**
继续使用Edge TTS，已经够用了。

**阶段2: 周末(2-3小时)**
部署GPT-SoVITS，训练小孩/老人声音模型。

```bash
# 周末任务清单
□ 1. 下载GPT-SoVITS整合包
□ 2. 解压并启动服务
□ 3. 录制/收集声音样本(小孩、老人)
□ 4. 训练声音模型(每个5分钟)
□ 5. 测试生成语音
```

**阶段3: 下周(1-2小时)**
决定集成方式：
- 如果只是偶尔用 → 用方案1(手动方式)
- 如果经常用 → 用方案2(自动化)

**阶段4: 逐步迁移**
- 先在1-2个广播剧中测试
- 验证音质提升
- 确认稳定后再全面使用

---

## 📊 决策树

```
开始
 ↓
是否需要真实小孩/老人声？
 ↓
否 → 继续用Edge TTS ✅
 ↓
是
 ↓
有技术能力部署GPT-SoVITS？
 ↓
否 → 考虑科大讯飞(付费)
 ↓
是
 ↓
愿意花2-3小时部署？
 ↓
否 → 继续用Edge TTS或用科大讯飞
 ↓
是 → 部署GPT-SoVITS ✅
```

---

## 💰 成本分析

### Edge TTS
- 部署成本: ¥0
- 使用成本: ¥0
- 时间成本: 0小时
- **总成本**: ¥0

### GPT-SoVITS
- 部署成本: ¥0(或¥9.9-29.9买整合包)
- 使用成本: ¥0
- 时间成本: 2-3小时(一次性)
- **总成本**: ¥0 + 2-3小时

### 科大讯飞
- 部署成本: ¥0
- 使用成本: ¥0.5/次
- 时间成本: 30分钟(配置API)
- **总成本**: 一部71集广播剧 ≈ ¥35

---

## ✅ 推荐行动

### 如果你是新手:
**今天：** 继续用Edge TTS
**周末：** 花点时间了解GPT-SoVITS，决定是否部署

### 如果你有技术基础:
**今天：** 开始部署GPT-SoVITS
**明天：** 训练声音模型
**后天：** 集成到项目

### 如果是商业项目:
**今天：** 申请科大讯飞账号
**明天：** 配置API并测试
**后天：** 集成到项目

---

## 📞 后续支持

如果在集成过程中遇到问题：
1. 查看常见问题部分
2. 查看官方文档
3. 向我提问，我会帮你解决

---

**总结：我推荐GPT-SoVITS，但建议你先用Edge TTS，等有时间再逐步集成GPT-SoVITS。**
