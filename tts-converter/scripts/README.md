# 广播剧制作工具使用指南

## 快速开始

### 方式1：一键提取对话

```bash
# 从Markdown脚本提取对话（自动优化）
python make_drama.py 广播剧脚本.md -o 广播剧_对话.txt

# 保留冒号（不替换为逗号）
python make_drama.py 广播剧脚本.md -o 广播剧_对话.txt --keep-colons
```

### 方式2：完整制作流程

```bash
# 步骤1: 提取对话
python make_drama.py 广播剧脚本.md -o 广播剧_对话.txt

# 步骤2: 生成音频
python drama_to_audio.py 广播剧_对话.txt 广播剧_最终.mp3
```

## 脚本格式要求

输入的Markdown脚本需要使用以下格式：

```markdown
**\[角色名\]**：
对话内容

**\[角色名\]**：
\[动作描述\] 对话内容
```

## 工具说明

### make_drama.py - 对话提取工具

**功能**：
- 从Markdown脚本中提取纯对话
- 自动去除动作描述（如 `\[...\]`）
- 自动替换冒号为逗号（提升TTS流畅度）
- 去除空行和角色介绍

**参数**：
- `input`: 输入的Markdown脚本文件
- `-o, --output`: 输出的对话文件（默认：广播剧_对话.txt）
- `--keep-colons`: 保留冒号，不替换为逗号

**示例**：
```bash
# 基础使用
python make_drama.py script.md

# 指定输出文件
python make_drama.py script.md -o dialogues.txt

# 保留冒号
python make_drama.py script.md --keep-colons
```

### drama_to_audio.py - 音频生成工具

**功能**：
- 为每个角色分配不同声音
- 生成高质量MP3音频
- 自动合并所有对话片段

**参数**：
- `input`: 对话文本文件
- `output`: 输出的MP3文件

**角色声音映射**：
- 旁白 → 云建（成熟男声）
- 和也 → 云希（少年男声）
- 艾米 → 晓晓（AI少女）
- 星空 → 晓伊（温柔少女）

**示例**：
```bash
python drama_to_audio.py dialogues.txt output.mp3
```

## 常见问题

### Q1: 如何添加新角色？

编辑 `drama_to_audio.py` 中的 `VOICE_MAP`：

```python
VOICE_MAP = {
    '你的角色名': 'zh-CN-XiaoxiaoNeural',
}
```

### Q2: 为什么要替换冒号为逗号？

TTS（文本转语音）在冒号处会有明显停顿，影响朗读流畅度。替换为逗号后，语调更自然。

### Q3: 如何修改声音？

参考以下声音列表：

**女声**：
- `zh-CN-XiaoxiaoNeural` - 晓晓（温柔）
- `zh-CN-XiaoyiNeural` - 晓伊（成熟）
- `zh-CN-XiaomengNeural` - 晓梦（活泼）

**男声**：
- `zh-CN-YunjianNeural` - 云建（成熟）
- `zh-CN-YunxiNeural` - 云希（年轻）
- `zh-CN-YunzeNeural` - 云泽（稳重）

## 完整示例

```bash
# 1. 准备脚本
# 文件: 广播剧脚本.md
# 内容:
# **\[旁白\]**：
# 新东京历，3024年。这是一个人类早已习惯将意识上传到云端的时代。
#
# **\[艾米\]**：
# \[机械式的轻快感\] 喂，和也，起床了。

# 2. 提取对话
python make_drama.py 广播剧脚本.md -o 广播剧_对话.txt

# 输出:
# 【旁白】新东京历，3024年。这是一个人类早已习惯将意识上传到云端的时代。
# 【艾米】喂，和也，起床了。

# 3. 生成音频
python drama_to_audio.py 广播剧_对话.txt 广播剧.mp3

# 完成！
# 文件: 广播剧.mp3 (2.9 MB)
```

## 输出示例

```
[INFO] 读取脚本: 广播剧脚本.md
[INFO] 提取到 65 个对话片段
[OK] 对话已保存: 广播剧_对话.txt

[预览] 前5条对话:
  1. 【旁白】新东京历，3024年。这是一个人类早已习惯将意识上传到云端的时代...
  2. 【艾米】喂，和也，起床了。根据早间气象和你的睡眠数据分析...
  3. 【和也】艾米……我求你了，能不能把闹钟铃声换成正常人类的...
  4. 【旁白】艾米在空中灵巧地翻了个身，全息裙摆随着物理引擎的波动...
  5. 【艾米】驳回。根据大数据分析，中二病是你这种平庸人设唯一能...

[提示] 下一步，使用以下命令生成音频:
  python drama_to_audio.py 广播剧_对话.txt 输出音频.mp3
```

## 技巧和建议

1. **脚本准备**：
   - 使用统一的格式 `**\[角色\]**：`
   - 动作描述放在 `\[...\]` 中
   - 每句对话单独一行

2. **角色命名**：
   - 使用简短易记的角色名
   - 避免使用特殊字符
   - 保持命名一致性

3. **声音选择**：
   - 旁白：成熟稳重
   - 主角：年轻活力
   - AI角色：活泼可爱

4. **质量检查**：
   - 先生成短片段测试
   - 检查对话完整性
   - 验证声音区分度

## 更新日志

### v1.0 (2025-01-26)
- ✅ 支持Markdown格式脚本
- ✅ 自动提取纯对话
- ✅ 智能去除动作描述
- ✅ 冒号自动替换为逗号
- ✅ 多角色配音支持
- ✅ 一键生成MP3音频
